{{define "swap_form"}}
<div class="swap-card fade-in">
    <!-- Card Header -->
    <div style="margin-bottom: 24px;">
        <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">Swap Crypto</h2>
        <p style="color: #64748b; font-size: 14px;">Best rates from {{.ExchangeCount}} exchanges. No KYC. Private & Secure.</p>
    </div>
    
    <!-- Swap Form -->
    <form id="swapForm">
        <!-- From Section -->
        <div class="input-section">
            <label style="color: #64748b; font-size: 12px; display: block; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.05em;">You Send</label>
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 16px;">
                <input type="number" 
                       name="amount"
                       placeholder="0.0"
                       step="any"
                       style="background: transparent; border: none; color: white; font-size: 28px; font-weight: 600; flex: 1; outline: none; min-width: 0;"
                       id="fromAmount"
                       hx-post="/htmx/quote"
                       hx-trigger="keyup changed delay:500ms"
                       hx-target="#rate-info"
                       hx-include="[name='from'],[name='to']">
                
                <div class="token-button" style="flex-shrink: 0;">
                    <div class="token-icon">
                        <span id="fromTokenIcon">BTC</span>
                    </div>
                    <select name="from" 
                            id="fromSelect"
                            class="token-select">
                        <option value="btc">BTC - Bitcoin</option>
                        <option value="eth">ETH - Ethereum</option>
                        <option value="usdt">USDT - Tether</option>
                    </select>
                    <svg style="width: 16px; height: 16px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Swap Button -->
        <div class="swap-button" onclick="swapPairs()">
            <svg style="width: 24px; height: 24px; color: #94a3b8;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
            </svg>
        </div>
        
        <!-- To Section -->
        <div class="input-section">
            <label style="color: #64748b; font-size: 12px; display: block; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.05em;">You Receive</label>
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 16px;">
                <input type="number" 
                       name="toAmount"
                       placeholder="0.0"
                       readonly
                       style="background: transparent; border: none; color: white; font-size: 28px; font-weight: 600; flex: 1; outline: none; opacity: 0.7; min-width: 0;"
                       id="toAmount">
                
                <div class="token-button" style="flex-shrink: 0;">
                    <div class="token-icon" style="background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);">
                        <span id="toTokenIcon">ETH</span>
                    </div>
                    <select name="to" 
                            id="toSelect"
                            class="token-select">
                        <option value="eth">ETH - Ethereum</option>
                        <option value="btc">BTC - Bitcoin</option>
                        <option value="usdt">USDT - Tether</option>
                    </select>
                    <svg style="width: 16px; height: 16px; flex-shrink: 0;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Wallet Address -->
        <details style="margin: 24px 0;">
            <summary style="cursor: pointer; color: #94a3b8; font-size: 14px; padding: 12px; background: rgba(8, 10, 28, 0.4); border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
                <span>Receiving Wallet Address</span>
                <svg style="width: 20px; height: 20px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
            </summary>
            <input type="text" 
                   name="to_address"
                   id="toAddress"
                   placeholder="Enter your wallet address"
                   style="width: 100%; background: rgba(8, 10, 28, 0.4); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 16px; color: white; font-size: 14px; margin-top: 12px; outline: none;"
                   onfocus="this.style.borderColor='rgba(139, 92, 246, 0.4)'"
                   onblur="this.style.borderColor='rgba(255, 255, 255, 0.05)'">
        </details>
        
        <!-- Rate Info -->
        <div id="rate-info" style="margin-bottom: 24px;">
            <!-- Quotes will load here via HTMX -->
        </div>
        
        <!-- Submit Button -->
        <button type="button" 
                class="primary-button"
                id="swapButton"
                onclick="executeSwap()"
                disabled>
            <span>Enter Amount To Preview Swap</span>
            <span class="spinner" style="margin-left: 8px;"></span>
        </button>
        
        <!-- Security Note -->
        <div style="margin-top: 16px; padding: 12px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 8px;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <svg style="width: 16px; height: 16px; color: #10b981;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
                <span style="color: #10b981; font-size: 12px;">No KYC • No Registration • Your Keys, Your Crypto</span>
            </div>
        </div>
    </form>
</div>

<script>
    // Cargar currencies cuando el componente se monta
    document.addEventListener('DOMContentLoaded', function() {
        // Cargar currencies para ambos selects
        htmx.ajax('GET', '/htmx/currencies', {
            target: '#fromSelect',
            swap: 'innerHTML'
        }).then(() => {
            document.getElementById('fromSelect').value = 'btc';
        });
        
        htmx.ajax('GET', '/htmx/currencies', {
            target: '#toSelect',
            swap: 'innerHTML'
        }).then(() => {
            document.getElementById('toSelect').value = 'eth';
        });
        
        // Configurar listeners para cambios
        document.getElementById('fromSelect').addEventListener('change', function() {
            htmx.trigger('#fromAmount', 'keyup');
        });
        
        document.getElementById('toSelect').addEventListener('change', function() {
            htmx.trigger('#fromAmount', 'keyup');
        });
    });
</script>
{{end}}